<!DOCTYPE html>
<html lang="zh-CN">

<head>

  <!-- Minima -->
  <!-- Hexo theme created by @adisaktijrs -->

  <!-- Basic Page Needs
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <meta charset="utf-8">

  
  <title>ã€Colabã€‘åŸºæœ¬æ“ä½œã€LeNetã€‘ã€MNISTã€‘è®­ç»ƒæµ‹è¯•</title>
  
  <link rel="canonical" href="https://guairen-7.github.io/2021/10/31/%E3%80%90Colab%E3%80%91%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E3%80%90LeNet%E3%80%91%E3%80%90MNIST%E3%80%91%E8%AE%AD%E7%BB%83%E6%B5%8B%E8%AF%95/">
  
  <meta name="description" content="Colab å®˜ç½‘åˆå§‹ç•Œé¢ 1.ä»‹ç»è‹±ä¼Ÿè¾¾å®˜ç½‘è°·æ­Œå°†åŸæ¥K80æ¢æˆäº†T4 2.æŸ¥çœ‹åŸºæœ¬é…ç½®2.1æŸ¥çœ‹pytorchç‰ˆæœ¬123import torchprint(torch)   2.2æŸ¥çœ‹æ˜¯å¦å¯ä»¥ä½¿ç”¨cuda1print(torch.cuda.device_count())  ä¿®æ”¹-&amp;gt;ç¬”è®°æœ¬è®¾ç½®">
  
  
  <meta name="author" content="AXDLMG7">
  
  
  
  <meta property="og:site_name" content="AXDLMG7&#39;s Blog" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="ã€Colabã€‘åŸºæœ¬æ“ä½œã€LeNetã€‘ã€MNISTã€‘è®­ç»ƒæµ‹è¯•" />
  
  <meta property="og:description" content="Colab å®˜ç½‘åˆå§‹ç•Œé¢ 1.ä»‹ç»è‹±ä¼Ÿè¾¾å®˜ç½‘è°·æ­Œå°†åŸæ¥K80æ¢æˆäº†T4 2.æŸ¥çœ‹åŸºæœ¬é…ç½®2.1æŸ¥çœ‹pytorchç‰ˆæœ¬123import torchprint(torch)   2.2æŸ¥çœ‹æ˜¯å¦å¯ä»¥ä½¿ç”¨cuda1print(torch.cuda.device_count())  ä¿®æ”¹-&amp;gt;ç¬”è®°æœ¬è®¾ç½®">
  
  <meta property="og:url" content="https://guairen-7.github.io/2021/10/31/%E3%80%90Colab%E3%80%91%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E3%80%90LeNet%E3%80%91%E3%80%90MNIST%E3%80%91%E8%AE%AD%E7%BB%83%E6%B5%8B%E8%AF%95/" />

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ã€Colabã€‘åŸºæœ¬æ“ä½œã€LeNetã€‘ã€MNISTã€‘è®­ç»ƒæµ‹è¯•">
  
  <meta name="twitter:description" content="Colab å®˜ç½‘åˆå§‹ç•Œé¢ 1.ä»‹ç»è‹±ä¼Ÿè¾¾å®˜ç½‘è°·æ­Œå°†åŸæ¥K80æ¢æˆäº†T4 2.æŸ¥çœ‹åŸºæœ¬é…ç½®2.1æŸ¥çœ‹pytorchç‰ˆæœ¬123import torchprint(torch)   2.2æŸ¥çœ‹æ˜¯å¦å¯ä»¥ä½¿ç”¨cuda1print(torch.cuda.device_count())  ä¿®æ”¹-&amp;gt;ç¬”è®°æœ¬è®¾ç½®">
  
  
  
  
  <meta name="twitter:url" content="https://guairen-7.github.io/2021/10/31/%E3%80%90Colab%E3%80%91%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E3%80%90LeNet%E3%80%91%E3%80%90MNIST%E3%80%91%E8%AE%AD%E7%BB%83%E6%B5%8B%E8%AF%95/" />

  <!-- Mobile Specific Metas
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Preload fonts
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <link rel="preload" href="/fonts/dm-serif-display-v4-latin-regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/fonts/inter-v2-latin-regular.woff2" as="font" type="font/woff2" crossorigin>

  <!-- CSS
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  
<link rel="stylesheet" href="/css/normalize.css">

  
<link rel="stylesheet" href="/css/skeleton.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
<link rel="stylesheet" href="/css/prism-dark.css">

  
<link rel="stylesheet" href="/css/prism-line-numbers.css">

  <!-- User css -->
  
  
<link rel="stylesheet" href="/css/user.css">

  

  <!-- Favicon
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <link rel="icon" type="image/png" href="/images/favicon.jpg">

  <!-- Custom Theme Color Style
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <style>
  a:not(.icon) {
    text-decoration-color: #0;
    background-image: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0) 50%,
      #0 50%
    );
  }
  blockquote {
    border-left: 8px solid #0;
  }
  .nanobar .bar {
    background: #0;
  }
  .button.button-primary:hover,
  button.button-primary:hover,
  input[type="submit"].button-primary:hover,
  input[type="reset"].button-primary:hover,
  input[type="button"].button-primary:hover,
  .button.button-primary:focus,
  button.button-primary:focus,
  input[type="submit"].button-primary:focus,
  input[type="reset"].button-primary:focus,
  input[type="button"].button-primary:focus {
    background-color: #0;
    border-color: #0;
  }
  input[type="email"]:focus,
  input[type="number"]:focus,
  input[type="search"]:focus,
  input[type="text"]:focus,
  input[type="tel"]:focus,
  input[type="url"]:focus,
  input[type="password"]:focus,
  textarea:focus,
  select:focus {
    border: 1px solid #0;
  }
</style>

  <!-- Google Analytics (With Privacy Settings On)
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  

  
  <script src="/js/pic.min.js" defer></script>
  

  
  <script src="/js/search.min.js" defer></script>
  

<meta name="generator" content="Hexo 5.4.1"></head>

<body>
  <div class="container">
    <div class="row">
      <div>

        <div class="row">
  <div class="two columns" style="max-width: 50px">
    <h1 class="mt-2 mode">
      <div onclick=setDarkMode(true) id="darkBtn">ğŸŒš</div>
      <div onclick=setDarkMode(false) id="lightBtn" class=hidden>ğŸŒ</div>
      <script >
        if (localStorage.getItem('preferredTheme') == 'dark') {
          setDarkMode(true)
        }
        function setDarkMode(isDark) {
          var darkBtn = document.getElementById('darkBtn')
          var lightBtn = document.getElementById('lightBtn')
          if (isDark) {
            lightBtn.style.display = "block"
            darkBtn.style.display = "none"
            localStorage.setItem('preferredTheme', 'dark');
          } else {
            lightBtn.style.display = "none"
            darkBtn.style.display = "block"
            localStorage.removeItem('preferredTheme');
          }
          document.body.classList.toggle("darkmode");
        }
      </script>
    </h1>
  </div>

  <div class="six columns ml-1">
    <h1 class="mt-2">
      çˆ±ç¬‘çš„å†·é¢é¬¼7
    </h1>
  </div>

  <div class="twelve columns">
    <div class="row">
      <div class="nine columns left">
        <a href="/">Home</a>
        
          
          <a href="/Works" class="ml">Works</a>
          
        
          
          <a href="/About" class="ml">About</a>
          
        
        
          
            <a href="mailto:test@test.test" target="_blank" class="ml">Email</a>
          
        
      </div>
    </div>
    <hr style="margin-bottom: 2.6rem">
  </div>
</div>

        <div class="trans">
            <h2>ã€Colabã€‘åŸºæœ¬æ“ä½œã€LeNetã€‘ã€MNISTã€‘è®­ç»ƒæµ‹è¯•</h2>

  <p><a target="_blank" rel="noopener" href="https://colab.research.google.com/notebooks/welcome.ipynb">Colab å®˜ç½‘åˆå§‹ç•Œé¢</a></p>
<h1 id="1-ä»‹ç»"><a href="#1-ä»‹ç»" class="headerlink" title="1.ä»‹ç»"></a>1.ä»‹ç»</h1><p><a target="_blank" rel="noopener" href="https://developer.nvidia.com/zh-cn/cuda-gpus">è‹±ä¼Ÿè¾¾å®˜ç½‘</a><br>è°·æ­Œå°†åŸæ¥K80æ¢æˆäº†T4<br><img src="https://img-blog.csdnimg.cn/7975074e2ece4cdc8be72e96851fd996.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQVhETE1H,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<h1 id="2-æŸ¥çœ‹åŸºæœ¬é…ç½®"><a href="#2-æŸ¥çœ‹åŸºæœ¬é…ç½®" class="headerlink" title="2.æŸ¥çœ‹åŸºæœ¬é…ç½®"></a>2.æŸ¥çœ‹åŸºæœ¬é…ç½®</h1><h3 id="2-1æŸ¥çœ‹pytorchç‰ˆæœ¬"><a href="#2-1æŸ¥çœ‹pytorchç‰ˆæœ¬" class="headerlink" title="2.1æŸ¥çœ‹pytorchç‰ˆæœ¬"></a>2.1æŸ¥çœ‹pytorchç‰ˆæœ¬</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(torch)</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/b08a271c94da4d0293ac0dbc8ff3cc25.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQVhETE1H,size_13,color_FFFFFF,t_70,g_se,x_16"></p>
<h3 id="2-2æŸ¥çœ‹æ˜¯å¦å¯ä»¥ä½¿ç”¨cuda"><a href="#2-2æŸ¥çœ‹æ˜¯å¦å¯ä»¥ä½¿ç”¨cuda" class="headerlink" title="2.2æŸ¥çœ‹æ˜¯å¦å¯ä»¥ä½¿ç”¨cuda"></a>2.2æŸ¥çœ‹æ˜¯å¦å¯ä»¥ä½¿ç”¨cuda</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(torch.cuda.device_count())</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/cce0d37208584800922981b38136b11f.png"><br>ä¿®æ”¹-&gt;ç¬”è®°æœ¬è®¾ç½®-&gt;GPU<br><img src="https://img-blog.csdnimg.cn/38bcb5ea6f724e1a8a120bd71614efcc.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQVhETE1H,size_19,color_FFFFFF,t_70,g_se,x_16"></p>
<h3 id="2-3æŸ¥çœ‹æ˜¾å¡é…ç½®"><a href="#2-3æŸ¥çœ‹æ˜¾å¡é…ç½®" class="headerlink" title="2.3æŸ¥çœ‹æ˜¾å¡é…ç½®"></a>2.3æŸ¥çœ‹æ˜¾å¡é…ç½®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">!nvidia-smi</span><br><span class="line">//æ³¨æ„è‹±æ–‡æ„Ÿå¹å·</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/a222ea06ae0c44ce8f34592494dca1c3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQVhETE1H,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<h1 id="3-æŒ‚è½½"><a href="#3-æŒ‚è½½" class="headerlink" title="3.æŒ‚è½½"></a>3.æŒ‚è½½</h1><h3 id="3-1æŒ‚è½½è°·æ­Œäº‘ç›˜"><a href="#3-1æŒ‚è½½è°·æ­Œäº‘ç›˜" class="headerlink" title="3.1æŒ‚è½½è°·æ­Œäº‘ç›˜"></a>3.1æŒ‚è½½è°·æ­Œäº‘ç›˜</h3><p>Colabçš„è¿è¡ŒåŸç†å®é™…ä¸Šå°±æ˜¯ç»™ä½ åˆ†é…ä¸€å°è¿œç¨‹çš„å¸¦GPUçš„ä¸»æœºï¼Œæ‰€ä»¥å®ƒçš„åŸå§‹è·¯å¾„ä¸æ˜¯ä½ çš„è°·æ­Œäº‘ç›˜ï¼ˆä¹Ÿå°±æ˜¯ä½ çš„ä»£ç æ–‡ä»¶ï¼‰æ‰€åœ¨çš„è·¯å¾„ã€‚æ‰€ä»¥ç¬¬ä¸€æ­¥æˆ‘ä»¬å…ˆè¦æŠŠè°·æ­Œäº‘ç›˜æŒ‚è½½å¸¦åˆ°é‚£å°è¿œç¨‹ä¸»æœºä¸Šï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> google.colab <span class="keyword">import</span> drive</span><br><span class="line">drive.mount(<span class="string">&quot;/content/drive&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>ç™»å½•è°·æ­Œè´¦å·å¹¶å°†éªŒè¯ç ç²˜åˆ°æ¡†ä¸­</p>
<h3 id="3-2æ›´æ”¹è¿è¡Œç›®å½•"><a href="#3-2æ›´æ”¹è¿è¡Œç›®å½•" class="headerlink" title="3.2æ›´æ”¹è¿è¡Œç›®å½•"></a>3.2æ›´æ”¹è¿è¡Œç›®å½•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">&quot;/content/drive/MyDrive/Colab Notebooks/LeNet_MNIST_train_test&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯æˆ‘çš„ç›®å½•ç»“æ„<br><img src="https://img-blog.csdnimg.cn/a96be368c2ef4298af8e0fae94d4f61d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAQVhETE1H,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<h1 id="4-è®­ç»ƒ"><a href="#4-è®­ç»ƒ" class="headerlink" title="4.è®­ç»ƒ"></a>4.è®­ç»ƒ</h1><p>ã€LeNetã€‘+ã€MNISTã€‘</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms</span><br><span class="line"><span class="keyword">import</span> time</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LeNet</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(LeNet, self).__init__()</span><br><span class="line">        self.model = nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">1</span>, <span class="number">6</span>, kernel_size=<span class="number">5</span>),</span><br><span class="line">            nn.MaxPool2d(kernel_size=<span class="number">2</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">6</span>, <span class="number">16</span>, kernel_size=<span class="number">5</span>),</span><br><span class="line">            nn.MaxPool2d(kernel_size=<span class="number">2</span>),</span><br><span class="line">            nn.Flatten(),</span><br><span class="line">            nn.Linear(<span class="number">16</span>*<span class="number">4</span>*<span class="number">4</span>, <span class="number">120</span>),</span><br><span class="line">            nn.Linear(<span class="number">120</span>, <span class="number">84</span>),</span><br><span class="line">            nn.Linear(<span class="number">84</span>, <span class="number">10</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        output = self.model(x)</span><br><span class="line">        <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">train_datasets = torchvision.datasets.MNIST(</span><br><span class="line">    root = <span class="string">r&#x27;../data&#x27;</span>,</span><br><span class="line">    download=<span class="literal">True</span>,</span><br><span class="line">    train=<span class="literal">True</span>,</span><br><span class="line">    transform=transforms.ToTensor()</span><br><span class="line">)</span><br><span class="line">train_dataloader = DataLoader(</span><br><span class="line">    dataset=train_datasets,</span><br><span class="line">    batch_size=<span class="number">64</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">test_datasets = torchvision.datasets.MNIST(</span><br><span class="line">    root = <span class="string">r&#x27;../data&#x27;</span>,</span><br><span class="line">    train=<span class="literal">False</span>,</span><br><span class="line">    download=<span class="literal">True</span>,</span><br><span class="line">    transform=transforms.ToTensor()</span><br><span class="line">)</span><br><span class="line">test_dataloader = DataLoader(</span><br><span class="line">    dataset=test_datasets,</span><br><span class="line">    batch_size=<span class="number">64</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">train_datasets_size = <span class="built_in">len</span>(train_datasets)</span><br><span class="line">test_datasets_size = <span class="built_in">len</span>(test_datasets)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;è®­ç»ƒé›†æ•°é‡ä¸ºï¼š&#123;&#125;&quot;</span>.<span class="built_in">format</span>(train_datasets_size))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æµ‹è¯•é›†æ•°é‡ä¸ºï¼š&#123;&#125;&quot;</span>.<span class="built_in">format</span>(test_datasets_size))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">runing_mode = <span class="string">&quot;gpu&quot;</span> <span class="comment"># cpu,gpu, gpus</span></span><br><span class="line"><span class="keyword">if</span> runing_mode == <span class="string">&quot;gpu&quot;</span> <span class="keyword">and</span> torch.cuda.is_available():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;use cuda&quot;</span>)</span><br><span class="line">    device = torch.device(<span class="string">&quot;cuda&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;use cpu&quot;</span>)</span><br><span class="line">    device = torch.device(<span class="string">&quot;cpu&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model = LeNet()</span><br><span class="line">model.to(device)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">loss_fn = nn.CrossEntropyLoss()</span><br><span class="line">loss_fn.to(device)</span><br><span class="line">learning_rate = <span class="number">1e-2</span></span><br><span class="line">optim = torch.optim.SGD(model.parameters(), lr=learning_rate)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">epoch = <span class="number">10</span></span><br><span class="line">train_step, test_step = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(epoch):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;~~~~~~~~~~~~ç¬¬&#123;&#125;è½®è®­ç»ƒå¼€å§‹~~~~~~~~~~~&quot;</span>.<span class="built_in">format</span>(i+<span class="number">1</span>))</span><br><span class="line">    start = time.time()</span><br><span class="line">    model.train()</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> train_dataloader:</span><br><span class="line">        imgs, targets = data</span><br><span class="line">        imgs, targets = imgs.to(device), targets.to(device)</span><br><span class="line">        output = model(imgs)</span><br><span class="line">        loss = loss_fn(output, targets)</span><br><span class="line"></span><br><span class="line">        optim.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optim.step()</span><br><span class="line"></span><br><span class="line">        train_step += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> train_step % <span class="number">200</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;ç¬¬&#123;&#125;æ¬¡è®­ç»ƒï¼Œloss=&#123;:.3f&#125;&quot;</span>.<span class="built_in">format</span>(train_step, loss.item()))</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        test_loss, true_num = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> data <span class="keyword">in</span> test_dataloader:</span><br><span class="line">            imgs, targets = data</span><br><span class="line">            imgs, targets = imgs.to(device), targets.to(device)</span><br><span class="line">            output = model(imgs)</span><br><span class="line">            test_loss += loss_fn(output, targets)</span><br><span class="line">            true_num += (output.argmax(<span class="number">1</span>) == targets).<span class="built_in">sum</span>()</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç¬¬&#123;&#125;è½®æµ‹è¯•é›†ä¸Šçš„loss:&#123;:.3f&#125;, æ­£ç¡®ç‡ä¸º:&#123;:.3f&#125;%,è€—æ—¶:&#123;:.3f&#125;&quot;</span>.<span class="built_in">format</span>(test_step+<span class="number">1</span>, test_loss.item(), <span class="number">100</span> * true_num / test_datasets_size, end-start))</span><br><span class="line">    test_step += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š<br>1.CPU<br><img src="https://img-blog.csdnimg.cn/14edcf10c0d446a189f4a6fc44fba1ce.png"><br>2.GPU<br><img src="https://img-blog.csdnimg.cn/f396f9c673a24d719516dd5abc055ba1.png"></p>
<h1 id="5-Reference"><a href="#5-Reference" class="headerlink" title="5.Reference"></a>5.Reference</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010881576/article/details/120919330">ã€ŠColabä½¿ç”¨è®­ç»ƒæŒ‡å—ã€‹ åšå¼ºçš„ç¾Šè„‚çƒ</a></p>

  <p><a class="classtest-link" href="/tags/LeNet/" rel="tag">LeNet</a>, <a class="classtest-link" href="/tags/MNIST/" rel="tag">MNIST</a> â€” 2021å¹´10æœˆ31æ—¥</p>
  


        </div>
        <div class="row mt-2">
  <h3>Search</h3>
  <div><input id="search-text" title="search" class="search-text" type="text" placeholder="search......"></div>
  <div style="margin-top: 1.5rem;">
    <ul id="result"></ul>
  </div>
</div>
        <div class="row mt-2">
  
</div>

      </div>

    </div>

  </div>
  <script src="/js/nanobar.min.js"></script>

  <script>
    var options = {
      classname: 'nanobar',
      id: 'myNanobar'
    };
    var nanobar = new Nanobar(options);
    nanobar.go(30);
    nanobar.go(76);
    nanobar.go(100);
  </script>

</body>

</html>